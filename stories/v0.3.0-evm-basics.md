# Story: v0.3.0 EVM Basics

> 实现 EVM 链的基础 RPC 集成：余额查询、转账功能，支持多链（Ethereum、Avalanche C-Chain、BNB Chain 等）。

## Goals
- 集成 zabi 库作为 EVM 交互依赖
- 实现 EVM 链余额查询工具 (get_evm_balance)
- 实现 EVM 链 ETH/原生代币转账工具 (evm_transfer)
- 支持多网络配置（mainnet/testnet）
- 复用 Solana 的密钥管理模式

## Acceptance Criteria

### Dependencies Integration
- [ ] 添加 zabi 作为构建依赖
- [ ] 更新 build.zig 配置模块导入
- [ ] 验证 Zig 0.15 兼容性

### EVM RPC Client (via zabi)
- [ ] HTTP Provider 连接
- [ ] 支持 getAddressBalance（native token）
- [ ] 支持 sendRawTransaction
- [ ] 支持 waitForTransactionReceipt
- [ ] 支持 getGasPrice / estimateGas
- [ ] 可配置 RPC endpoint（多链支持）

### Wallet/Signing (via zabi)
- [ ] 从私钥创建 Wallet
- [ ] 从文件加载私钥（类似 Solana 模式）
- [ ] 支持 EIP-1559 交易签名
- [ ] 支持 Legacy 交易签名

### Tools Implementation
- [ ] `tools/evm_balance.zig` 实现 EVM 余额查询
  - 参数: chain, address, network
  - 返回: balance (wei), balance (ETH/native)
- [ ] `tools/evm_transfer.zig` 实现原生代币转账
  - 参数: to_address, amount, network, chain, keypair_path (optional)
  - 返回: tx_hash, tx details
- [ ] `tools/registry.zig` 注册新工具

### Multi-Chain Configuration
- [ ] Ethereum: mainnet, sepolia, goerli
- [ ] Avalanche C-Chain: mainnet, fuji
- [ ] BNB Chain: mainnet, testnet
- [ ] 支持自定义 RPC endpoint

### Configuration
- [ ] 支持 EVM_PRIVATE_KEY 环境变量
- [ ] 支持 ~/.config/evm/keyfile.json 配置文件
- [ ] 支持 network 参数配置 RPC endpoint

### Testing
- [ ] get_evm_balance 在 Sepolia 上验证
- [ ] evm_transfer 在 Sepolia 上验证
- [ ] 多链切换测试

## Technical Notes

### zabi Library
- GitHub: https://github.com/Raiden1411/zabi
- 功能：EVM RPC、ABI 编解码、交易签名、Wallet 管理
- 支持 HTTP/WebSocket/IPC 连接

### EVM RPC Endpoints
```
Ethereum:
- Mainnet: https://eth.llamarpc.com 或 Infura/Alchemy
- Sepolia: https://rpc.sepolia.org

Avalanche C-Chain:
- Mainnet: https://api.avax.network/ext/bc/C/rpc
- Fuji: https://api.avax-test.network/ext/bc/C/rpc

BNB Chain:
- Mainnet: https://bsc-dataseed.binance.org
- Testnet: https://data-seed-prebsc-1-s1.binance.org:8545
```

### Key zabi APIs
```zig
// Provider
const provider = try HttpProvider.init(.{ .uri = endpoint });
const balance = try provider.getAddressBalance(.{ .address = addr });

// Wallet
const wallet = Wallet.init(private_key, allocator, &provider);
const tx_hash = try wallet.sendTransaction(.{ .to = recipient, .value = amount });
const receipt = try wallet.waitForTransactionReceipt(tx_hash);
```

### Private Key Format
EVM 私钥为 32 字节十六进制字符串（64 个字符，可带 0x 前缀）

## Dependencies
- zabi: EVM RPC client, transaction builder, wallet

## Completion Status
- Start date: 2026-01-23
- Completion date: -
- Status: ⏳ In Progress
